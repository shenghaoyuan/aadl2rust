RustModule {
    name: "robot_ba",
    docs: [
        "// Auto-generated from AADL package: Robot_BA",
    ],
    items: [
        TypeAlias(
            TypeAlias {
                name: "Alpha_Type",
                target: Named(
                    "bool",
                ),
                vis: Public,
                docs: [
                    "// AADL Data Type: Alpha_Type",
                ],
            },
        ),
        Mod(
            RustModule {
                name: "collecte_donnee_spg",
                docs: [
                    "// Auto-generated from AADL subprogram: collecte_donnee_spg",
                    "// C binding to: collecte_donnee",
                    "// source_files: robot.c",
                ],
                items: [
                    Use(
                        UseStatement {
                            path: [
                                "super",
                            ],
                            kind: Nested(
                                [
                                    "collecte_donnee",
                                ],
                            ),
                        },
                    ),
                    Function(
                        FunctionDef {
                            name: "send",
                            params: [
                                Param {
                                    name: "d_source",
                                    ty: Reference(
                                        Named(
                                            "bool",
                                        ),
                                        true,
                                        true,
                                    ),
                                },
                            ],
                            return_type: Unit,
                            body: Block {
                                stmts: [
                                    Expr(
                                        Unsafe(
                                            Block {
                                                stmts: [
                                                    Expr(
                                                        Call(
                                                            Path(
                                                                [
                                                                    "collecte_donnee",
                                                                ],
                                                                Namespace,
                                                            ),
                                                            [
                                                                Ident(
                                                                    "d_source",
                                                                ),
                                                            ],
                                                        ),
                                                    ),
                                                ],
                                                expr: None,
                                            },
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: Public,
                            docs: [
                                "// Wrapper for C function collecte_donnee",
                                "// Original AADL port: d_source",
                            ],
                            attrs: [],
                        },
                    ),
                ],
                attrs: [],
                vis: Public,
            },
        ),
        Mod(
            RustModule {
                name: "traite_spg_in",
                docs: [
                    "// Auto-generated from AADL subprogram: traite_spg_in",
                    "// C binding to: traite_in",
                    "// source_files: robot.c",
                ],
                items: [
                    Use(
                        UseStatement {
                            path: [
                                "super",
                            ],
                            kind: Nested(
                                [
                                    "traite_in",
                                ],
                            ),
                        },
                    ),
                    Function(
                        FunctionDef {
                            name: "receive",
                            params: [
                                Param {
                                    name: "d_info",
                                    ty: Reference(
                                        Named(
                                            "bool",
                                        ),
                                        false,
                                        false,
                                    ),
                                },
                            ],
                            return_type: Unit,
                            body: Block {
                                stmts: [
                                    Expr(
                                        Unsafe(
                                            Block {
                                                stmts: [
                                                    Expr(
                                                        Call(
                                                            Path(
                                                                [
                                                                    "traite_in",
                                                                ],
                                                                Namespace,
                                                            ),
                                                            [
                                                                Ident(
                                                                    "d_info",
                                                                ),
                                                            ],
                                                        ),
                                                    ),
                                                ],
                                                expr: None,
                                            },
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: Public,
                            docs: [
                                "// Wrapper for C function traite_in",
                                "// Original AADL port: d_info",
                            ],
                            attrs: [],
                        },
                    ),
                ],
                attrs: [],
                vis: Public,
            },
        ),
        Mod(
            RustModule {
                name: "traite_spg_out",
                docs: [
                    "// Auto-generated from AADL subprogram: traite_spg_out",
                    "// C binding to: traite_out",
                    "// source_files: robot.c",
                ],
                items: [
                    Use(
                        UseStatement {
                            path: [
                                "super",
                            ],
                            kind: Nested(
                                [
                                    "traite_out",
                                ],
                            ),
                        },
                    ),
                    Function(
                        FunctionDef {
                            name: "send",
                            params: [
                                Param {
                                    name: "d_ordre",
                                    ty: Reference(
                                        Named(
                                            "bool",
                                        ),
                                        true,
                                        true,
                                    ),
                                },
                            ],
                            return_type: Unit,
                            body: Block {
                                stmts: [
                                    Expr(
                                        Unsafe(
                                            Block {
                                                stmts: [
                                                    Expr(
                                                        Call(
                                                            Path(
                                                                [
                                                                    "traite_out",
                                                                ],
                                                                Namespace,
                                                            ),
                                                            [
                                                                Ident(
                                                                    "d_ordre",
                                                                ),
                                                            ],
                                                        ),
                                                    ),
                                                ],
                                                expr: None,
                                            },
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: Public,
                            docs: [
                                "// Wrapper for C function traite_out",
                                "// Original AADL port: d_ordre",
                            ],
                            attrs: [],
                        },
                    ),
                ],
                attrs: [],
                vis: Public,
            },
        ),
        Mod(
            RustModule {
                name: "action_spg",
                docs: [
                    "// Auto-generated from AADL subprogram: action_spg",
                    "// C binding to: action",
                    "// source_files: robot.c",
                ],
                items: [
                    Use(
                        UseStatement {
                            path: [
                                "super",
                            ],
                            kind: Nested(
                                [
                                    "action",
                                ],
                            ),
                        },
                    ),
                    Function(
                        FunctionDef {
                            name: "receive",
                            params: [
                                Param {
                                    name: "d_action",
                                    ty: Reference(
                                        Named(
                                            "bool",
                                        ),
                                        false,
                                        false,
                                    ),
                                },
                            ],
                            return_type: Unit,
                            body: Block {
                                stmts: [
                                    Expr(
                                        Unsafe(
                                            Block {
                                                stmts: [
                                                    Expr(
                                                        Call(
                                                            Path(
                                                                [
                                                                    "action",
                                                                ],
                                                                Namespace,
                                                            ),
                                                            [
                                                                Ident(
                                                                    "d_action",
                                                                ),
                                                            ],
                                                        ),
                                                    ),
                                                ],
                                                expr: None,
                                            },
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: Public,
                            docs: [
                                "// Wrapper for C function action",
                                "// Original AADL port: d_action",
                            ],
                            attrs: [],
                        },
                    ),
                ],
                attrs: [],
                vis: Public,
            },
        ),
        Struct(
            StructDef {
                name: "capteurThread",
                fields: [
                    Field {
                        name: "evenement",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "Sender",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// Port: evenement Out",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "cpu_id",
                        ty: Named(
                            "isize",
                        ),
                        docs: [
                            "// 结构体新增 CPU ID",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "dispatch_protocol",
                        ty: Named(
                            "String",
                        ),
                        docs: [
                            "// AADL属性(impl): Dispatch_Protocol",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "period",
                        ty: Named(
                            "u64",
                        ),
                        docs: [
                            "// AADL属性(impl): Period",
                        ],
                        attrs: [],
                    },
                ],
                properties: [],
                generics: [],
                derives: [
                    "Debug",
                ],
                docs: [
                    "// AADL Thread: capteur",
                ],
                vis: Public,
            },
        ),
        Struct(
            StructDef {
                name: "controleThread",
                fields: [
                    Field {
                        name: "info_capteur",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "Receiver",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// Port: info_capteur In",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "comm_servo",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "Sender",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// Port: comm_servo Out",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "cpu_id",
                        ty: Named(
                            "isize",
                        ),
                        docs: [
                            "// 结构体新增 CPU ID",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "dispatch_protocol",
                        ty: Named(
                            "String",
                        ),
                        docs: [
                            "// AADL属性(impl): Dispatch_Protocol",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "period",
                        ty: Named(
                            "u64",
                        ),
                        docs: [
                            "// AADL属性(impl): Period",
                        ],
                        attrs: [],
                    },
                ],
                properties: [],
                generics: [],
                derives: [
                    "Debug",
                ],
                docs: [
                    "// AADL Thread: controle",
                ],
                vis: Public,
            },
        ),
        Struct(
            StructDef {
                name: "servomoteurThread",
                fields: [
                    Field {
                        name: "ordre",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "Receiver",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// Port: ordre In",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "cpu_id",
                        ty: Named(
                            "isize",
                        ),
                        docs: [
                            "// 结构体新增 CPU ID",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "dispatch_protocol",
                        ty: Named(
                            "String",
                        ),
                        docs: [
                            "// AADL属性(impl): Dispatch_Protocol",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "period",
                        ty: Named(
                            "u64",
                        ),
                        docs: [
                            "// AADL属性(impl): Period",
                        ],
                        attrs: [],
                    },
                ],
                properties: [],
                generics: [],
                derives: [
                    "Debug",
                ],
                docs: [
                    "// AADL Thread: servomoteur",
                ],
                vis: Public,
            },
        ),
        Impl(
            ImplBlock {
                target: Named(
                    "capteurThread",
                ),
                generics: [],
                items: [
                    Method(
                        FunctionDef {
                            name: "new",
                            params: [
                                Param {
                                    name: "cpu_id",
                                    ty: Named(
                                        "isize",
                                    ),
                                },
                            ],
                            return_type: Named(
                                "Self",
                            ),
                            body: Block {
                                stmts: [
                                    Expr(
                                        Ident(
                                            "return Self {\n            period: 110, \n            evenement: None, \n            dispatch_protocol: \"Periodic\".to_string(), \n            cpu_id: cpu_id, // CPU ID\n        }",
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: None,
                            docs: [
                                "// 创建组件并初始化AADL属性",
                            ],
                            attrs: [],
                        },
                    ),
                    Method(
                        FunctionDef {
                            name: "run",
                            params: [
                                Param {
                                    name: "",
                                    ty: Reference(
                                        Named(
                                            "self",
                                        ),
                                        false,
                                        true,
                                    ),
                                },
                            ],
                            return_type: Unit,
                            body: Block {
                                stmts: [
                                    Expr(
                                        Unsafe(
                                            Block {
                                                stmts: [
                                                    Let(
                                                        LetStmt {
                                                            ifmut: false,
                                                            name: "prio",
                                                            ty: None,
                                                            init: Some(
                                                                Call(
                                                                    Path(
                                                                        [
                                                                            "period_to_priority",
                                                                        ],
                                                                        Namespace,
                                                                    ),
                                                                    [
                                                                        Ident(
                                                                            "self.period as f64",
                                                                        ),
                                                                    ],
                                                                ),
                                                            ),
                                                        },
                                                    ),
                                                    Let(
                                                        LetStmt {
                                                            ifmut: true,
                                                            name: "param",
                                                            ty: Some(
                                                                Named(
                                                                    "sched_param",
                                                                ),
                                                            ),
                                                            init: Some(
                                                                Ident(
                                                                    "sched_param { sched_priority: prio }",
                                                                ),
                                                            ),
                                                        },
                                                    ),
                                                    Let(
                                                        LetStmt {
                                                            ifmut: false,
                                                            name: "ret",
                                                            ty: None,
                                                            init: Some(
                                                                Call(
                                                                    Path(
                                                                        [
                                                                            "pthread_setschedparam",
                                                                        ],
                                                                        Namespace,
                                                                    ),
                                                                    [
                                                                        Call(
                                                                            Path(
                                                                                [
                                                                                    "pthread_self",
                                                                                ],
                                                                                Namespace,
                                                                            ),
                                                                            [],
                                                                        ),
                                                                        MethodCall(
                                                                            MethodCall(
                                                                                Path(
                                                                                    [
                                                                                        "*CPU_ID_TO_SCHED_POLICY",
                                                                                    ],
                                                                                    Namespace,
                                                                                ),
                                                                                "get",
                                                                                [
                                                                                    Reference(
                                                                                        Path(
                                                                                            [
                                                                                                "self",
                                                                                                "cpu_id",
                                                                                            ],
                                                                                            Member,
                                                                                        ),
                                                                                        true,
                                                                                        false,
                                                                                    ),
                                                                                ],
                                                                            ),
                                                                            "unwrap_or",
                                                                            [
                                                                                Reference(
                                                                                    Path(
                                                                                        [
                                                                                            "SCHED_FIFO",
                                                                                        ],
                                                                                        Namespace,
                                                                                    ),
                                                                                    true,
                                                                                    false,
                                                                                ),
                                                                            ],
                                                                        ),
                                                                        Reference(
                                                                            Ident(
                                                                                "param",
                                                                            ),
                                                                            true,
                                                                            true,
                                                                        ),
                                                                    ],
                                                                ),
                                                            ),
                                                        },
                                                    ),
                                                    Expr(
                                                        If {
                                                            condition: BinaryOp(
                                                                Ident(
                                                                    "ret",
                                                                ),
                                                                "!=",
                                                                Literal(
                                                                    Int(
                                                                        0,
                                                                    ),
                                                                ),
                                                            ),
                                                            then_branch: Block {
                                                                stmts: [
                                                                    Expr(
                                                                        Call(
                                                                            Path(
                                                                                [
                                                                                    "eprintln!",
                                                                                ],
                                                                                Namespace,
                                                                            ),
                                                                            [
                                                                                Literal(
                                                                                    Str(
                                                                                        "capteurThread: Failed to set thread priority from period: {}",
                                                                                    ),
                                                                                ),
                                                                                Ident(
                                                                                    "ret",
                                                                                ),
                                                                            ],
                                                                        ),
                                                                    ),
                                                                ],
                                                                expr: None,
                                                            },
                                                            else_branch: None,
                                                        },
                                                    ),
                                                ],
                                                expr: None,
                                            },
                                        ),
                                    ),
                                    Expr(
                                        If {
                                            condition: BinaryOp(
                                                Path(
                                                    [
                                                        "self",
                                                        "cpu_id",
                                                    ],
                                                    Member,
                                                ),
                                                ">",
                                                Literal(
                                                    Int(
                                                        -1,
                                                    ),
                                                ),
                                            ),
                                            then_branch: Block {
                                                stmts: [
                                                    Expr(
                                                        Call(
                                                            Path(
                                                                [
                                                                    "set_thread_affinity",
                                                                ],
                                                                Namespace,
                                                            ),
                                                            [
                                                                Path(
                                                                    [
                                                                        "self",
                                                                        "cpu_id",
                                                                    ],
                                                                    Member,
                                                                ),
                                                            ],
                                                        ),
                                                    ),
                                                ],
                                                expr: None,
                                            },
                                            else_branch: None,
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "period",
                                            ty: Some(
                                                Path(
                                                    [
                                                        "std",
                                                        "time",
                                                        "Duration",
                                                    ],
                                                ),
                                            ),
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "Duration",
                                                            "from_millis",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [
                                                        Literal(
                                                            Int(
                                                                110,
                                                            ),
                                                        ),
                                                    ],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        Loop(
                                            Block {
                                                stmts: [
                                                    Let(
                                                        LetStmt {
                                                            ifmut: false,
                                                            name: "start",
                                                            ty: None,
                                                            init: Some(
                                                                Call(
                                                                    Path(
                                                                        [
                                                                            "Instant",
                                                                            "now",
                                                                        ],
                                                                        Namespace,
                                                                    ),
                                                                    [],
                                                                ),
                                                            ),
                                                        },
                                                    ),
                                                    Expr(
                                                        Block(
                                                            Block {
                                                                stmts: [
                                                                    Expr(
                                                                        Ident(
                                                                            "// --- 调用序列（等价 AADL 的 Wrapper）---\n                           // d_spg()",
                                                                        ),
                                                                    ),
                                                                    Expr(
                                                                        Ident(
                                                                            "// d_spg",
                                                                        ),
                                                                    ),
                                                                    Expr(
                                                                        IfLet {
                                                                            pattern: "Some(sender)",
                                                                            value: Reference(
                                                                                Path(
                                                                                    [
                                                                                        "self",
                                                                                        "evenement",
                                                                                    ],
                                                                                    Member,
                                                                                ),
                                                                                true,
                                                                                false,
                                                                            ),
                                                                            then_branch: Block {
                                                                                stmts: [
                                                                                    Let(
                                                                                        LetStmt {
                                                                                            ifmut: true,
                                                                                            name: "val",
                                                                                            ty: None,
                                                                                            init: Some(
                                                                                                Literal(
                                                                                                    Bool(
                                                                                                        false,
                                                                                                    ),
                                                                                                ),
                                                                                            ),
                                                                                        },
                                                                                    ),
                                                                                    Expr(
                                                                                        Call(
                                                                                            Path(
                                                                                                [
                                                                                                    "collecte_donnee_spg",
                                                                                                    "send",
                                                                                                ],
                                                                                                Namespace,
                                                                                            ),
                                                                                            [
                                                                                                Reference(
                                                                                                    Ident(
                                                                                                        "val",
                                                                                                    ),
                                                                                                    true,
                                                                                                    true,
                                                                                                ),
                                                                                            ],
                                                                                        ),
                                                                                    ),
                                                                                    Expr(
                                                                                        MethodCall(
                                                                                            MethodCall(
                                                                                                Ident(
                                                                                                    "sender",
                                                                                                ),
                                                                                                "send",
                                                                                                [
                                                                                                    Ident(
                                                                                                        "val",
                                                                                                    ),
                                                                                                ],
                                                                                            ),
                                                                                            "unwrap",
                                                                                            [],
                                                                                        ),
                                                                                    ),
                                                                                ],
                                                                                expr: None,
                                                                            },
                                                                            else_branch: None,
                                                                        },
                                                                    ),
                                                                ],
                                                                expr: None,
                                                            },
                                                        ),
                                                    ),
                                                    Let(
                                                        LetStmt {
                                                            ifmut: false,
                                                            name: "elapsed",
                                                            ty: None,
                                                            init: Some(
                                                                MethodCall(
                                                                    Ident(
                                                                        "start",
                                                                    ),
                                                                    "elapsed",
                                                                    [],
                                                                ),
                                                            ),
                                                        },
                                                    ),
                                                    Expr(
                                                        MethodCall(
                                                            Path(
                                                                [
                                                                    "std",
                                                                    "thread",
                                                                    "sleep",
                                                                ],
                                                                Namespace,
                                                            ),
                                                            "",
                                                            [
                                                                MethodCall(
                                                                    Ident(
                                                                        "period",
                                                                    ),
                                                                    "saturating_sub",
                                                                    [
                                                                        Ident(
                                                                            "elapsed",
                                                                        ),
                                                                    ],
                                                                ),
                                                            ],
                                                        ),
                                                    ),
                                                ],
                                                expr: None,
                                            },
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: None,
                            docs: [
                                "// Thread execution entry point",
                                "// Period: Some(110) ms",
                            ],
                            attrs: [],
                        },
                    ),
                ],
                trait_impl: Some(
                    Named(
                        "Thread",
                    ),
                ),
            },
        ),
        Impl(
            ImplBlock {
                target: Named(
                    "controleThread",
                ),
                generics: [],
                items: [
                    Method(
                        FunctionDef {
                            name: "new",
                            params: [
                                Param {
                                    name: "cpu_id",
                                    ty: Named(
                                        "isize",
                                    ),
                                },
                            ],
                            return_type: Named(
                                "Self",
                            ),
                            body: Block {
                                stmts: [
                                    Expr(
                                        Ident(
                                            "return Self {\n            dispatch_protocol: \"Periodic\".to_string(), \n            comm_servo: None, \n            period: 110, \n            info_capteur: None, \n            cpu_id: cpu_id, // CPU ID\n        }",
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: None,
                            docs: [
                                "// 创建组件并初始化AADL属性",
                            ],
                            attrs: [],
                        },
                    ),
                    Method(
                        FunctionDef {
                            name: "run",
                            params: [
                                Param {
                                    name: "",
                                    ty: Reference(
                                        Named(
                                            "self",
                                        ),
                                        false,
                                        true,
                                    ),
                                },
                            ],
                            return_type: Unit,
                            body: Block {
                                stmts: [
                                    Expr(
                                        Unsafe(
                                            Block {
                                                stmts: [
                                                    Let(
                                                        LetStmt {
                                                            ifmut: false,
                                                            name: "prio",
                                                            ty: None,
                                                            init: Some(
                                                                Call(
                                                                    Path(
                                                                        [
                                                                            "period_to_priority",
                                                                        ],
                                                                        Namespace,
                                                                    ),
                                                                    [
                                                                        Ident(
                                                                            "self.period as f64",
                                                                        ),
                                                                    ],
                                                                ),
                                                            ),
                                                        },
                                                    ),
                                                    Let(
                                                        LetStmt {
                                                            ifmut: true,
                                                            name: "param",
                                                            ty: Some(
                                                                Named(
                                                                    "sched_param",
                                                                ),
                                                            ),
                                                            init: Some(
                                                                Ident(
                                                                    "sched_param { sched_priority: prio }",
                                                                ),
                                                            ),
                                                        },
                                                    ),
                                                    Let(
                                                        LetStmt {
                                                            ifmut: false,
                                                            name: "ret",
                                                            ty: None,
                                                            init: Some(
                                                                Call(
                                                                    Path(
                                                                        [
                                                                            "pthread_setschedparam",
                                                                        ],
                                                                        Namespace,
                                                                    ),
                                                                    [
                                                                        Call(
                                                                            Path(
                                                                                [
                                                                                    "pthread_self",
                                                                                ],
                                                                                Namespace,
                                                                            ),
                                                                            [],
                                                                        ),
                                                                        MethodCall(
                                                                            MethodCall(
                                                                                Path(
                                                                                    [
                                                                                        "*CPU_ID_TO_SCHED_POLICY",
                                                                                    ],
                                                                                    Namespace,
                                                                                ),
                                                                                "get",
                                                                                [
                                                                                    Reference(
                                                                                        Path(
                                                                                            [
                                                                                                "self",
                                                                                                "cpu_id",
                                                                                            ],
                                                                                            Member,
                                                                                        ),
                                                                                        true,
                                                                                        false,
                                                                                    ),
                                                                                ],
                                                                            ),
                                                                            "unwrap_or",
                                                                            [
                                                                                Reference(
                                                                                    Path(
                                                                                        [
                                                                                            "SCHED_FIFO",
                                                                                        ],
                                                                                        Namespace,
                                                                                    ),
                                                                                    true,
                                                                                    false,
                                                                                ),
                                                                            ],
                                                                        ),
                                                                        Reference(
                                                                            Ident(
                                                                                "param",
                                                                            ),
                                                                            true,
                                                                            true,
                                                                        ),
                                                                    ],
                                                                ),
                                                            ),
                                                        },
                                                    ),
                                                    Expr(
                                                        If {
                                                            condition: BinaryOp(
                                                                Ident(
                                                                    "ret",
                                                                ),
                                                                "!=",
                                                                Literal(
                                                                    Int(
                                                                        0,
                                                                    ),
                                                                ),
                                                            ),
                                                            then_branch: Block {
                                                                stmts: [
                                                                    Expr(
                                                                        Call(
                                                                            Path(
                                                                                [
                                                                                    "eprintln!",
                                                                                ],
                                                                                Namespace,
                                                                            ),
                                                                            [
                                                                                Literal(
                                                                                    Str(
                                                                                        "controleThread: Failed to set thread priority from period: {}",
                                                                                    ),
                                                                                ),
                                                                                Ident(
                                                                                    "ret",
                                                                                ),
                                                                            ],
                                                                        ),
                                                                    ),
                                                                ],
                                                                expr: None,
                                                            },
                                                            else_branch: None,
                                                        },
                                                    ),
                                                ],
                                                expr: None,
                                            },
                                        ),
                                    ),
                                    Expr(
                                        If {
                                            condition: BinaryOp(
                                                Path(
                                                    [
                                                        "self",
                                                        "cpu_id",
                                                    ],
                                                    Member,
                                                ),
                                                ">",
                                                Literal(
                                                    Int(
                                                        -1,
                                                    ),
                                                ),
                                            ),
                                            then_branch: Block {
                                                stmts: [
                                                    Expr(
                                                        Call(
                                                            Path(
                                                                [
                                                                    "set_thread_affinity",
                                                                ],
                                                                Namespace,
                                                            ),
                                                            [
                                                                Path(
                                                                    [
                                                                        "self",
                                                                        "cpu_id",
                                                                    ],
                                                                    Member,
                                                                ),
                                                            ],
                                                        ),
                                                    ),
                                                ],
                                                expr: None,
                                            },
                                            else_branch: None,
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "period",
                                            ty: Some(
                                                Path(
                                                    [
                                                        "std",
                                                        "time",
                                                        "Duration",
                                                    ],
                                                ),
                                            ),
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "Duration",
                                                            "from_millis",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [
                                                        Literal(
                                                            Int(
                                                                110,
                                                            ),
                                                        ),
                                                    ],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        Loop(
                                            Block {
                                                stmts: [
                                                    Let(
                                                        LetStmt {
                                                            ifmut: false,
                                                            name: "start",
                                                            ty: None,
                                                            init: Some(
                                                                Call(
                                                                    Path(
                                                                        [
                                                                            "Instant",
                                                                            "now",
                                                                        ],
                                                                        Namespace,
                                                                    ),
                                                                    [],
                                                                ),
                                                            ),
                                                        },
                                                    ),
                                                    Expr(
                                                        Block(
                                                            Block {
                                                                stmts: [
                                                                    Expr(
                                                                        Ident(
                                                                            "// --- 调用序列（等价 AADL 的 Wrapper）---\n                           // t_spg_in() -> t_spg_out()",
                                                                        ),
                                                                    ),
                                                                    Expr(
                                                                        Ident(
                                                                            "// t_spg_in",
                                                                        ),
                                                                    ),
                                                                    Expr(
                                                                        IfLet {
                                                                            pattern: "Some(receiver)",
                                                                            value: Reference(
                                                                                Path(
                                                                                    [
                                                                                        "self",
                                                                                        "info_capteur",
                                                                                    ],
                                                                                    Member,
                                                                                ),
                                                                                true,
                                                                                false,
                                                                            ),
                                                                            then_branch: Block {
                                                                                stmts: [
                                                                                    Expr(
                                                                                        Match {
                                                                                            expr: MethodCall(
                                                                                                Ident(
                                                                                                    "receiver",
                                                                                                ),
                                                                                                "try_recv",
                                                                                                [],
                                                                                            ),
                                                                                            arms: [
                                                                                                MatchArm {
                                                                                                    pattern: "Ok(val)",
                                                                                                    guard: None,
                                                                                                    body: Block {
                                                                                                        stmts: [
                                                                                                            Expr(
                                                                                                                Call(
                                                                                                                    Path(
                                                                                                                        [
                                                                                                                            "traite_spg_in",
                                                                                                                            "receive",
                                                                                                                        ],
                                                                                                                        Namespace,
                                                                                                                    ),
                                                                                                                    [
                                                                                                                        Ident(
                                                                                                                            "val",
                                                                                                                        ),
                                                                                                                    ],
                                                                                                                ),
                                                                                                            ),
                                                                                                        ],
                                                                                                        expr: None,
                                                                                                    },
                                                                                                },
                                                                                                MatchArm {
                                                                                                    pattern: "Err(crossbeam_channel::TryRecvError::Empty)",
                                                                                                    guard: None,
                                                                                                    body: Block {
                                                                                                        stmts: [],
                                                                                                        expr: None,
                                                                                                    },
                                                                                                },
                                                                                                MatchArm {
                                                                                                    pattern: "Err(crossbeam_channel::TryRecvError::Disconnected)",
                                                                                                    guard: None,
                                                                                                    body: Block {
                                                                                                        stmts: [
                                                                                                            Expr(
                                                                                                                Call(
                                                                                                                    Path(
                                                                                                                        [
                                                                                                                            "eprintln!",
                                                                                                                        ],
                                                                                                                        Namespace,
                                                                                                                    ),
                                                                                                                    [
                                                                                                                        Literal(
                                                                                                                            Str(
                                                                                                                                "channel closed",
                                                                                                                            ),
                                                                                                                        ),
                                                                                                                    ],
                                                                                                                ),
                                                                                                            ),
                                                                                                        ],
                                                                                                        expr: None,
                                                                                                    },
                                                                                                },
                                                                                            ],
                                                                                        },
                                                                                    ),
                                                                                ],
                                                                                expr: None,
                                                                            },
                                                                            else_branch: None,
                                                                        },
                                                                    ),
                                                                    Expr(
                                                                        Ident(
                                                                            "// t_spg_out",
                                                                        ),
                                                                    ),
                                                                    Expr(
                                                                        IfLet {
                                                                            pattern: "Some(sender)",
                                                                            value: Reference(
                                                                                Path(
                                                                                    [
                                                                                        "self",
                                                                                        "comm_servo",
                                                                                    ],
                                                                                    Member,
                                                                                ),
                                                                                true,
                                                                                false,
                                                                            ),
                                                                            then_branch: Block {
                                                                                stmts: [
                                                                                    Let(
                                                                                        LetStmt {
                                                                                            ifmut: true,
                                                                                            name: "val",
                                                                                            ty: None,
                                                                                            init: Some(
                                                                                                Literal(
                                                                                                    Bool(
                                                                                                        false,
                                                                                                    ),
                                                                                                ),
                                                                                            ),
                                                                                        },
                                                                                    ),
                                                                                    Expr(
                                                                                        Call(
                                                                                            Path(
                                                                                                [
                                                                                                    "traite_spg_out",
                                                                                                    "send",
                                                                                                ],
                                                                                                Namespace,
                                                                                            ),
                                                                                            [
                                                                                                Reference(
                                                                                                    Ident(
                                                                                                        "val",
                                                                                                    ),
                                                                                                    true,
                                                                                                    true,
                                                                                                ),
                                                                                            ],
                                                                                        ),
                                                                                    ),
                                                                                    Expr(
                                                                                        MethodCall(
                                                                                            MethodCall(
                                                                                                Ident(
                                                                                                    "sender",
                                                                                                ),
                                                                                                "send",
                                                                                                [
                                                                                                    Ident(
                                                                                                        "val",
                                                                                                    ),
                                                                                                ],
                                                                                            ),
                                                                                            "unwrap",
                                                                                            [],
                                                                                        ),
                                                                                    ),
                                                                                ],
                                                                                expr: None,
                                                                            },
                                                                            else_branch: None,
                                                                        },
                                                                    ),
                                                                ],
                                                                expr: None,
                                                            },
                                                        ),
                                                    ),
                                                    Let(
                                                        LetStmt {
                                                            ifmut: false,
                                                            name: "elapsed",
                                                            ty: None,
                                                            init: Some(
                                                                MethodCall(
                                                                    Ident(
                                                                        "start",
                                                                    ),
                                                                    "elapsed",
                                                                    [],
                                                                ),
                                                            ),
                                                        },
                                                    ),
                                                    Expr(
                                                        MethodCall(
                                                            Path(
                                                                [
                                                                    "std",
                                                                    "thread",
                                                                    "sleep",
                                                                ],
                                                                Namespace,
                                                            ),
                                                            "",
                                                            [
                                                                MethodCall(
                                                                    Ident(
                                                                        "period",
                                                                    ),
                                                                    "saturating_sub",
                                                                    [
                                                                        Ident(
                                                                            "elapsed",
                                                                        ),
                                                                    ],
                                                                ),
                                                            ],
                                                        ),
                                                    ),
                                                ],
                                                expr: None,
                                            },
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: None,
                            docs: [
                                "// Thread execution entry point",
                                "// Period: Some(110) ms",
                            ],
                            attrs: [],
                        },
                    ),
                ],
                trait_impl: Some(
                    Named(
                        "Thread",
                    ),
                ),
            },
        ),
        Impl(
            ImplBlock {
                target: Named(
                    "servomoteurThread",
                ),
                generics: [],
                items: [
                    Method(
                        FunctionDef {
                            name: "new",
                            params: [
                                Param {
                                    name: "cpu_id",
                                    ty: Named(
                                        "isize",
                                    ),
                                },
                            ],
                            return_type: Named(
                                "Self",
                            ),
                            body: Block {
                                stmts: [
                                    Expr(
                                        Ident(
                                            "return Self {\n            period: 10, \n            ordre: None, \n            dispatch_protocol: \"Sporadic\".to_string(), \n            cpu_id: cpu_id, // CPU ID\n        }",
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: None,
                            docs: [
                                "// 创建组件并初始化AADL属性",
                            ],
                            attrs: [],
                        },
                    ),
                    Method(
                        FunctionDef {
                            name: "run",
                            params: [
                                Param {
                                    name: "",
                                    ty: Reference(
                                        Named(
                                            "self",
                                        ),
                                        false,
                                        true,
                                    ),
                                },
                            ],
                            return_type: Unit,
                            body: Block {
                                stmts: [
                                    Expr(
                                        Unsafe(
                                            Block {
                                                stmts: [
                                                    Let(
                                                        LetStmt {
                                                            ifmut: false,
                                                            name: "prio",
                                                            ty: None,
                                                            init: Some(
                                                                Call(
                                                                    Path(
                                                                        [
                                                                            "period_to_priority",
                                                                        ],
                                                                        Namespace,
                                                                    ),
                                                                    [
                                                                        Ident(
                                                                            "self.period as f64",
                                                                        ),
                                                                    ],
                                                                ),
                                                            ),
                                                        },
                                                    ),
                                                    Let(
                                                        LetStmt {
                                                            ifmut: true,
                                                            name: "param",
                                                            ty: Some(
                                                                Named(
                                                                    "sched_param",
                                                                ),
                                                            ),
                                                            init: Some(
                                                                Ident(
                                                                    "sched_param { sched_priority: prio }",
                                                                ),
                                                            ),
                                                        },
                                                    ),
                                                    Let(
                                                        LetStmt {
                                                            ifmut: false,
                                                            name: "ret",
                                                            ty: None,
                                                            init: Some(
                                                                Call(
                                                                    Path(
                                                                        [
                                                                            "pthread_setschedparam",
                                                                        ],
                                                                        Namespace,
                                                                    ),
                                                                    [
                                                                        Call(
                                                                            Path(
                                                                                [
                                                                                    "pthread_self",
                                                                                ],
                                                                                Namespace,
                                                                            ),
                                                                            [],
                                                                        ),
                                                                        MethodCall(
                                                                            MethodCall(
                                                                                Path(
                                                                                    [
                                                                                        "*CPU_ID_TO_SCHED_POLICY",
                                                                                    ],
                                                                                    Namespace,
                                                                                ),
                                                                                "get",
                                                                                [
                                                                                    Reference(
                                                                                        Path(
                                                                                            [
                                                                                                "self",
                                                                                                "cpu_id",
                                                                                            ],
                                                                                            Member,
                                                                                        ),
                                                                                        true,
                                                                                        false,
                                                                                    ),
                                                                                ],
                                                                            ),
                                                                            "unwrap_or",
                                                                            [
                                                                                Reference(
                                                                                    Path(
                                                                                        [
                                                                                            "SCHED_FIFO",
                                                                                        ],
                                                                                        Namespace,
                                                                                    ),
                                                                                    true,
                                                                                    false,
                                                                                ),
                                                                            ],
                                                                        ),
                                                                        Reference(
                                                                            Ident(
                                                                                "param",
                                                                            ),
                                                                            true,
                                                                            true,
                                                                        ),
                                                                    ],
                                                                ),
                                                            ),
                                                        },
                                                    ),
                                                    Expr(
                                                        If {
                                                            condition: BinaryOp(
                                                                Ident(
                                                                    "ret",
                                                                ),
                                                                "!=",
                                                                Literal(
                                                                    Int(
                                                                        0,
                                                                    ),
                                                                ),
                                                            ),
                                                            then_branch: Block {
                                                                stmts: [
                                                                    Expr(
                                                                        Call(
                                                                            Path(
                                                                                [
                                                                                    "eprintln!",
                                                                                ],
                                                                                Namespace,
                                                                            ),
                                                                            [
                                                                                Literal(
                                                                                    Str(
                                                                                        "servomoteurThread: Failed to set thread priority from period: {}",
                                                                                    ),
                                                                                ),
                                                                                Ident(
                                                                                    "ret",
                                                                                ),
                                                                            ],
                                                                        ),
                                                                    ),
                                                                ],
                                                                expr: None,
                                                            },
                                                            else_branch: None,
                                                        },
                                                    ),
                                                ],
                                                expr: None,
                                            },
                                        ),
                                    ),
                                    Expr(
                                        If {
                                            condition: BinaryOp(
                                                Path(
                                                    [
                                                        "self",
                                                        "cpu_id",
                                                    ],
                                                    Member,
                                                ),
                                                ">",
                                                Literal(
                                                    Int(
                                                        -1,
                                                    ),
                                                ),
                                            ),
                                            then_branch: Block {
                                                stmts: [
                                                    Expr(
                                                        Call(
                                                            Path(
                                                                [
                                                                    "set_thread_affinity",
                                                                ],
                                                                Namespace,
                                                            ),
                                                            [
                                                                Path(
                                                                    [
                                                                        "self",
                                                                        "cpu_id",
                                                                    ],
                                                                    Member,
                                                                ),
                                                            ],
                                                        ),
                                                    ),
                                                ],
                                                expr: None,
                                            },
                                            else_branch: None,
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "min_interarrival",
                                            ty: Some(
                                                Path(
                                                    [
                                                        "std",
                                                        "time",
                                                        "Duration",
                                                    ],
                                                ),
                                            ),
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "Duration",
                                                            "from_millis",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [
                                                        Literal(
                                                            Int(
                                                                10,
                                                            ),
                                                        ),
                                                    ],
                                                ),
                                            ),
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: true,
                                            name: "last_dispatch",
                                            ty: Some(
                                                Path(
                                                    [
                                                        "std",
                                                        "time",
                                                        "Instant",
                                                    ],
                                                ),
                                            ),
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "Instant",
                                                            "now",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: true,
                                            name: "events",
                                            ty: None,
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "Vec",
                                                            "new",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        Loop(
                                            Block {
                                                stmts: [
                                                    Expr(
                                                        If {
                                                            condition: MethodCall(
                                                                Ident(
                                                                    "events",
                                                                ),
                                                                "is_empty",
                                                                [],
                                                            ),
                                                            then_branch: Block {
                                                                stmts: [
                                                                    Expr(
                                                                        IfLet {
                                                                            pattern: "Some(rx)",
                                                                            value: Reference(
                                                                                Path(
                                                                                    [
                                                                                        "self",
                                                                                        "ordre",
                                                                                    ],
                                                                                    Member,
                                                                                ),
                                                                                true,
                                                                                false,
                                                                            ),
                                                                            then_branch: Block {
                                                                                stmts: [
                                                                                    Expr(
                                                                                        IfLet {
                                                                                            pattern: "Ok(val)",
                                                                                            value: MethodCall(
                                                                                                Ident(
                                                                                                    "rx",
                                                                                                ),
                                                                                                "try_recv",
                                                                                                [],
                                                                                            ),
                                                                                            then_branch: Block {
                                                                                                stmts: [
                                                                                                    Let(
                                                                                                        LetStmt {
                                                                                                            ifmut: false,
                                                                                                            name: "ts",
                                                                                                            ty: None,
                                                                                                            init: Some(
                                                                                                                Call(
                                                                                                                    Path(
                                                                                                                        [
                                                                                                                            "Instant",
                                                                                                                            "now",
                                                                                                                        ],
                                                                                                                        Namespace,
                                                                                                                    ),
                                                                                                                    [],
                                                                                                                ),
                                                                                                            ),
                                                                                                        },
                                                                                                    ),
                                                                                                    Expr(
                                                                                                        MethodCall(
                                                                                                            Ident(
                                                                                                                "events",
                                                                                                            ),
                                                                                                            "push",
                                                                                                            [
                                                                                                                Parenthesized(
                                                                                                                    Call(
                                                                                                                        Ident(
                                                                                                                            "",
                                                                                                                        ),
                                                                                                                        [
                                                                                                                            Ident(
                                                                                                                                "val",
                                                                                                                            ),
                                                                                                                            Literal(
                                                                                                                                Int(
                                                                                                                                    0,
                                                                                                                                ),
                                                                                                                            ),
                                                                                                                            Ident(
                                                                                                                                "ts",
                                                                                                                            ),
                                                                                                                        ],
                                                                                                                    ),
                                                                                                                ),
                                                                                                            ],
                                                                                                        ),
                                                                                                    ),
                                                                                                ],
                                                                                                expr: None,
                                                                                            },
                                                                                            else_branch: None,
                                                                                        },
                                                                                    ),
                                                                                ],
                                                                                expr: None,
                                                                            },
                                                                            else_branch: None,
                                                                        },
                                                                    ),
                                                                ],
                                                                expr: None,
                                                            },
                                                            else_branch: None,
                                                        },
                                                    ),
                                                    Expr(
                                                        IfLet {
                                                            pattern: "Some((idx, (val, _urgency, _ts)))",
                                                            value: MethodCall(
                                                                MethodCall(
                                                                    MethodCall(
                                                                        Ident(
                                                                            "events",
                                                                        ),
                                                                        "iter",
                                                                        [],
                                                                    ),
                                                                    "enumerate",
                                                                    [],
                                                                ),
                                                                "max_by",
                                                                [
                                                                    Ident(
                                                                        "|a, b| match a.1.1.cmp(&b.1.1) {\n                        std::cmp::Ordering::Equal => b.1.2.cmp(&a.1.2),\n                        other => other,\n                    }",
                                                                    ),
                                                                ],
                                                            ),
                                                            then_branch: Block {
                                                                stmts: [
                                                                    Let(
                                                                        LetStmt {
                                                                            ifmut: false,
                                                                            name: "(val, _, _)",
                                                                            ty: None,
                                                                            init: Some(
                                                                                MethodCall(
                                                                                    Ident(
                                                                                        "events",
                                                                                    ),
                                                                                    "remove",
                                                                                    [
                                                                                        Ident(
                                                                                            "idx",
                                                                                        ),
                                                                                    ],
                                                                                ),
                                                                            ),
                                                                        },
                                                                    ),
                                                                    Let(
                                                                        LetStmt {
                                                                            ifmut: false,
                                                                            name: "now",
                                                                            ty: None,
                                                                            init: Some(
                                                                                Call(
                                                                                    Path(
                                                                                        [
                                                                                            "Instant",
                                                                                            "now",
                                                                                        ],
                                                                                        Namespace,
                                                                                    ),
                                                                                    [],
                                                                                ),
                                                                            ),
                                                                        },
                                                                    ),
                                                                    Let(
                                                                        LetStmt {
                                                                            ifmut: false,
                                                                            name: "elapsed",
                                                                            ty: None,
                                                                            init: Some(
                                                                                MethodCall(
                                                                                    Ident(
                                                                                        "now",
                                                                                    ),
                                                                                    "duration_since",
                                                                                    [
                                                                                        Ident(
                                                                                            "last_dispatch",
                                                                                        ),
                                                                                    ],
                                                                                ),
                                                                            ),
                                                                        },
                                                                    ),
                                                                    Expr(
                                                                        If {
                                                                            condition: BinaryOp(
                                                                                Ident(
                                                                                    "elapsed",
                                                                                ),
                                                                                "<",
                                                                                Ident(
                                                                                    "min_interarrival",
                                                                                ),
                                                                            ),
                                                                            then_branch: Block {
                                                                                stmts: [
                                                                                    Expr(
                                                                                        MethodCall(
                                                                                            Path(
                                                                                                [
                                                                                                    "std",
                                                                                                    "thread",
                                                                                                    "sleep",
                                                                                                ],
                                                                                                Namespace,
                                                                                            ),
                                                                                            "",
                                                                                            [
                                                                                                BinaryOp(
                                                                                                    Ident(
                                                                                                        "min_interarrival",
                                                                                                    ),
                                                                                                    "-",
                                                                                                    Ident(
                                                                                                        "elapsed",
                                                                                                    ),
                                                                                                ),
                                                                                            ],
                                                                                        ),
                                                                                    ),
                                                                                ],
                                                                                expr: None,
                                                                            },
                                                                            else_branch: None,
                                                                        },
                                                                    ),
                                                                    Expr(
                                                                        Block(
                                                                            Block {
                                                                                stmts: [
                                                                                    Expr(
                                                                                        Ident(
                                                                                            "// --- 调用序列（等价 AADL 的 Wrapper）---\n                           // a_spg()",
                                                                                        ),
                                                                                    ),
                                                                                    Expr(
                                                                                        Ident(
                                                                                            "// a_spg",
                                                                                        ),
                                                                                    ),
                                                                                    Expr(
                                                                                        Call(
                                                                                            Path(
                                                                                                [
                                                                                                    "action_spg",
                                                                                                    "receive",
                                                                                                ],
                                                                                                Namespace,
                                                                                            ),
                                                                                            [
                                                                                                Ident(
                                                                                                    "val",
                                                                                                ),
                                                                                            ],
                                                                                        ),
                                                                                    ),
                                                                                ],
                                                                                expr: None,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    Expr(
                                                                        Assign(
                                                                            Ident(
                                                                                "last_dispatch",
                                                                            ),
                                                                            Call(
                                                                                Path(
                                                                                    [
                                                                                        "Instant",
                                                                                        "now",
                                                                                    ],
                                                                                    Namespace,
                                                                                ),
                                                                                [],
                                                                            ),
                                                                        ),
                                                                    ),
                                                                ],
                                                                expr: None,
                                                            },
                                                            else_branch: Some(
                                                                Block {
                                                                    stmts: [
                                                                        Expr(
                                                                            MethodCall(
                                                                                Path(
                                                                                    [
                                                                                        "std",
                                                                                        "thread",
                                                                                        "sleep",
                                                                                    ],
                                                                                    Namespace,
                                                                                ),
                                                                                "",
                                                                                [
                                                                                    Call(
                                                                                        Path(
                                                                                            [
                                                                                                "Duration",
                                                                                                "from_millis",
                                                                                            ],
                                                                                            Namespace,
                                                                                        ),
                                                                                        [
                                                                                            Literal(
                                                                                                Int(
                                                                                                    1,
                                                                                                ),
                                                                                            ),
                                                                                        ],
                                                                                    ),
                                                                                ],
                                                                            ),
                                                                        ),
                                                                    ],
                                                                    expr: None,
                                                                },
                                                            ),
                                                        },
                                                    ),
                                                ],
                                                expr: None,
                                            },
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: None,
                            docs: [
                                "// Thread execution entry point",
                                "// Period: Some(10) ms",
                            ],
                            attrs: [],
                        },
                    ),
                ],
                trait_impl: Some(
                    Named(
                        "Thread",
                    ),
                ),
            },
        ),
        Struct(
            StructDef {
                name: "p_capteurProcess",
                fields: [
                    Field {
                        name: "evenement",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "Sender",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// Port: evenement Out",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "cpu_id",
                        ty: Named(
                            "isize",
                        ),
                        docs: [
                            "// 进程 CPU ID",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "evenementRece",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "Receiver",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// 内部端口: evenement Out",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "th_c",
                        ty: Named(
                            "capteurThread",
                        ),
                        docs: [
                            "// 子组件线程（th_c : thread capteur）",
                        ],
                        attrs: [
                            Attribute {
                                name: "allow",
                                args: [
                                    Ident(
                                        "dead_code",
                                    ),
                                ],
                            },
                        ],
                    },
                ],
                properties: [],
                generics: [],
                derives: [
                    "Debug",
                ],
                docs: [
                    "// AADL Process: p_capteur",
                ],
                vis: Public,
            },
        ),
        Struct(
            StructDef {
                name: "p_controleProcess",
                fields: [
                    Field {
                        name: "info_capteur_droit",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "Receiver",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// Port: info_capteur_droit In",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "comm_servo_droit",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "Sender",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// Port: comm_servo_droit Out",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "info_capteur_gauche",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "Receiver",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// Port: info_capteur_gauche In",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "comm_servo_gauche",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "Sender",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// Port: comm_servo_gauche Out",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "cpu_id",
                        ty: Named(
                            "isize",
                        ),
                        docs: [
                            "// 进程 CPU ID",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "info_capteur_droitSend",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "BcSender",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// 内部端口: info_capteur_droit In",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "comm_servo_droitRece",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "Receiver",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// 内部端口: comm_servo_droit Out",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "info_capteur_gaucheSend",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "BcSender",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// 内部端口: info_capteur_gauche In",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "comm_servo_gaucheRece",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "Receiver",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// 内部端口: comm_servo_gauche Out",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "th_ctrl_droit",
                        ty: Named(
                            "controleThread",
                        ),
                        docs: [
                            "// 子组件线程（th_ctrl_droit : thread controle）",
                        ],
                        attrs: [
                            Attribute {
                                name: "allow",
                                args: [
                                    Ident(
                                        "dead_code",
                                    ),
                                ],
                            },
                        ],
                    },
                    Field {
                        name: "th_ctrl_gauche",
                        ty: Named(
                            "controleThread",
                        ),
                        docs: [
                            "// 子组件线程（th_ctrl_gauche : thread controle）",
                        ],
                        attrs: [
                            Attribute {
                                name: "allow",
                                args: [
                                    Ident(
                                        "dead_code",
                                    ),
                                ],
                            },
                        ],
                    },
                ],
                properties: [],
                generics: [],
                derives: [
                    "Debug",
                ],
                docs: [
                    "// AADL Process: p_controle",
                ],
                vis: Public,
            },
        ),
        Struct(
            StructDef {
                name: "p_servomoteurProcess",
                fields: [
                    Field {
                        name: "ordre",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "Receiver",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// Port: ordre In",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "cpu_id",
                        ty: Named(
                            "isize",
                        ),
                        docs: [
                            "// 进程 CPU ID",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "ordreSend",
                        ty: Generic(
                            "Option",
                            [
                                Generic(
                                    "BcSender",
                                    [
                                        Named(
                                            "bool",
                                        ),
                                    ],
                                ),
                            ],
                        ),
                        docs: [
                            "// 内部端口: ordre In",
                        ],
                        attrs: [],
                    },
                    Field {
                        name: "th_servomoteur",
                        ty: Named(
                            "servomoteurThread",
                        ),
                        docs: [
                            "// 子组件线程（th_servomoteur : thread servomoteur）",
                        ],
                        attrs: [
                            Attribute {
                                name: "allow",
                                args: [
                                    Ident(
                                        "dead_code",
                                    ),
                                ],
                            },
                        ],
                    },
                ],
                properties: [],
                generics: [],
                derives: [
                    "Debug",
                ],
                docs: [
                    "// AADL Process: p_servomoteur",
                ],
                vis: Public,
            },
        ),
        Impl(
            ImplBlock {
                target: Named(
                    "p_capteurProcess",
                ),
                generics: [],
                items: [
                    Method(
                        FunctionDef {
                            name: "new",
                            params: [
                                Param {
                                    name: "cpu_id",
                                    ty: Named(
                                        "isize",
                                    ),
                                },
                            ],
                            return_type: Named(
                                "Self",
                            ),
                            body: Block {
                                stmts: [
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "mut th_c",
                                            ty: Some(
                                                Named(
                                                    "capteurThread",
                                                ),
                                            ),
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "capteurThread",
                                                            "new",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [
                                                        Ident(
                                                            "cpu_id",
                                                        ),
                                                    ],
                                                ),
                                            ),
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: true,
                                            name: "evenementRece",
                                            ty: None,
                                            init: Some(
                                                Ident(
                                                    "None",
                                                ),
                                            ),
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "channel",
                                            ty: None,
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "crossbeam_channel",
                                                            "unbounded",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            Ident(
                                                "th_c.evenement",
                                            ),
                                            "send",
                                            [
                                                Call(
                                                    Path(
                                                        [
                                                            "Some",
                                                        ],
                                                        Member,
                                                    ),
                                                    [
                                                        Ident(
                                                            "channel.0",
                                                        ),
                                                    ],
                                                ),
                                            ],
                                        ),
                                    ),
                                    Expr(
                                        BinaryOp(
                                            Ident(
                                                "evenementRece",
                                            ),
                                            "=",
                                            Call(
                                                Path(
                                                    [
                                                        "Some",
                                                    ],
                                                    Member,
                                                ),
                                                [
                                                    Ident(
                                                        "channel.1",
                                                    ),
                                                ],
                                            ),
                                        ),
                                    ),
                                    Expr(
                                        Ident(
                                            "return Self { evenement: None, evenementRece, th_c, cpu_id }  //显式return",
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: None,
                            docs: [
                                "// Creates a new process instance",
                            ],
                            attrs: [],
                        },
                    ),
                    Method(
                        FunctionDef {
                            name: "start",
                            params: [
                                Param {
                                    name: "self",
                                    ty: Named(
                                        "Self",
                                    ),
                                },
                            ],
                            return_type: Unit,
                            body: Block {
                                stmts: [
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "Self { evenement, evenementRece, th_c, cpu_id, .. }",
                                            ty: None,
                                            init: Some(
                                                Ident(
                                                    "self",
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            BuilderChain(
                                                [
                                                    Named(
                                                        "\"th_c\".to_string()",
                                                    ),
                                                    Spawn {
                                                        closure: Closure(
                                                            [],
                                                            MethodCall(
                                                                Ident(
                                                                    "th_c",
                                                                ),
                                                                "run",
                                                                [],
                                                            ),
                                                        ),
                                                        move_kw: false,
                                                    },
                                                ],
                                            ),
                                            "unwrap",
                                            [],
                                        ),
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: true,
                                            name: "evenementRece_rx",
                                            ty: None,
                                            init: Some(
                                                MethodCall(
                                                    Ident(
                                                        "evenementRece",
                                                    ),
                                                    "unwrap",
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            BuilderChain(
                                                [
                                                    Named(
                                                        "\"data_forwarder_evenementRece\".to_string()",
                                                    ),
                                                    Spawn {
                                                        closure: Closure(
                                                            [],
                                                            Block(
                                                                Block {
                                                                    stmts: [
                                                                        Expr(
                                                                            Loop(
                                                                                Block {
                                                                                    stmts: [
                                                                                        Expr(
                                                                                            IfLet {
                                                                                                pattern: "Ok(msg)",
                                                                                                value: MethodCall(
                                                                                                    Ident(
                                                                                                        "evenementRece_rx",
                                                                                                    ),
                                                                                                    "try_recv",
                                                                                                    [],
                                                                                                ),
                                                                                                then_branch: Block {
                                                                                                    stmts: [
                                                                                                        Expr(
                                                                                                            IfLet {
                                                                                                                pattern: "Some(tx)",
                                                                                                                value: Reference(
                                                                                                                    Ident(
                                                                                                                        "evenement",
                                                                                                                    ),
                                                                                                                    true,
                                                                                                                    false,
                                                                                                                ),
                                                                                                                then_branch: Block {
                                                                                                                    stmts: [
                                                                                                                        Let(
                                                                                                                            LetStmt {
                                                                                                                                ifmut: false,
                                                                                                                                name: "_",
                                                                                                                                ty: None,
                                                                                                                                init: Some(
                                                                                                                                    MethodCall(
                                                                                                                                        Ident(
                                                                                                                                            "tx",
                                                                                                                                        ),
                                                                                                                                        "send",
                                                                                                                                        [
                                                                                                                                            Ident(
                                                                                                                                                "msg",
                                                                                                                                            ),
                                                                                                                                        ],
                                                                                                                                    ),
                                                                                                                                ),
                                                                                                                            },
                                                                                                                        ),
                                                                                                                    ],
                                                                                                                    expr: None,
                                                                                                                },
                                                                                                                else_branch: None,
                                                                                                            },
                                                                                                        ),
                                                                                                    ],
                                                                                                    expr: None,
                                                                                                },
                                                                                                else_branch: None,
                                                                                            },
                                                                                        ),
                                                                                        Expr(
                                                                                            MethodCall(
                                                                                                Path(
                                                                                                    [
                                                                                                        "std",
                                                                                                        "thread",
                                                                                                        "sleep",
                                                                                                    ],
                                                                                                    Namespace,
                                                                                                ),
                                                                                                "",
                                                                                                [
                                                                                                    MethodCall(
                                                                                                        Path(
                                                                                                            [
                                                                                                                "std",
                                                                                                                "time",
                                                                                                                "Duration",
                                                                                                                "from_millis",
                                                                                                            ],
                                                                                                            Namespace,
                                                                                                        ),
                                                                                                        "",
                                                                                                        [
                                                                                                            Literal(
                                                                                                                Int(
                                                                                                                    1,
                                                                                                                ),
                                                                                                            ),
                                                                                                        ],
                                                                                                    ),
                                                                                                ],
                                                                                            ),
                                                                                        ),
                                                                                    ],
                                                                                    expr: None,
                                                                                },
                                                                            ),
                                                                        ),
                                                                    ],
                                                                    expr: None,
                                                                },
                                                            ),
                                                        ),
                                                        move_kw: true,
                                                    },
                                                ],
                                            ),
                                            "unwrap",
                                            [],
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: None,
                            docs: [
                                "// Starts all threads in the process",
                            ],
                            attrs: [],
                        },
                    ),
                ],
                trait_impl: Some(
                    Named(
                        "Process",
                    ),
                ),
            },
        ),
        Impl(
            ImplBlock {
                target: Named(
                    "p_controleProcess",
                ),
                generics: [],
                items: [
                    Method(
                        FunctionDef {
                            name: "new",
                            params: [
                                Param {
                                    name: "cpu_id",
                                    ty: Named(
                                        "isize",
                                    ),
                                },
                            ],
                            return_type: Named(
                                "Self",
                            ),
                            body: Block {
                                stmts: [
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "mut th_ctrl_droit",
                                            ty: Some(
                                                Named(
                                                    "controleThread",
                                                ),
                                            ),
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "controleThread",
                                                            "new",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [
                                                        Ident(
                                                            "cpu_id",
                                                        ),
                                                    ],
                                                ),
                                            ),
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "mut th_ctrl_gauche",
                                            ty: Some(
                                                Named(
                                                    "controleThread",
                                                ),
                                            ),
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "controleThread",
                                                            "new",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [
                                                        Ident(
                                                            "cpu_id",
                                                        ),
                                                    ],
                                                ),
                                            ),
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: true,
                                            name: "info_capteur_droitSend",
                                            ty: None,
                                            init: Some(
                                                Ident(
                                                    "None",
                                                ),
                                            ),
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: true,
                                            name: "comm_servo_droitRece",
                                            ty: None,
                                            init: Some(
                                                Ident(
                                                    "None",
                                                ),
                                            ),
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: true,
                                            name: "info_capteur_gaucheSend",
                                            ty: None,
                                            init: Some(
                                                Ident(
                                                    "None",
                                                ),
                                            ),
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: true,
                                            name: "comm_servo_gaucheRece",
                                            ty: None,
                                            init: Some(
                                                Ident(
                                                    "None",
                                                ),
                                            ),
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "channel",
                                            ty: None,
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "crossbeam_channel",
                                                            "unbounded",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        BinaryOp(
                                            Ident(
                                                "info_capteur_droitSend",
                                            ),
                                            "=",
                                            Call(
                                                Path(
                                                    [
                                                        "Some",
                                                    ],
                                                    Member,
                                                ),
                                                [
                                                    Ident(
                                                        "channel.0",
                                                    ),
                                                ],
                                            ),
                                        ),
                                    ),
                                    Expr(
                                        MethodCall(
                                            Ident(
                                                "th_ctrl_droit.info_capteur",
                                            ),
                                            "receive",
                                            [
                                                Call(
                                                    Path(
                                                        [
                                                            "Some",
                                                        ],
                                                        Member,
                                                    ),
                                                    [
                                                        Ident(
                                                            "channel.1",
                                                        ),
                                                    ],
                                                ),
                                            ],
                                        ),
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "channel",
                                            ty: None,
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "crossbeam_channel",
                                                            "unbounded",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            Ident(
                                                "th_ctrl_droit.comm_servo",
                                            ),
                                            "send",
                                            [
                                                Call(
                                                    Path(
                                                        [
                                                            "Some",
                                                        ],
                                                        Member,
                                                    ),
                                                    [
                                                        Ident(
                                                            "channel.0",
                                                        ),
                                                    ],
                                                ),
                                            ],
                                        ),
                                    ),
                                    Expr(
                                        BinaryOp(
                                            Ident(
                                                "comm_servo_droitRece",
                                            ),
                                            "=",
                                            Call(
                                                Path(
                                                    [
                                                        "Some",
                                                    ],
                                                    Member,
                                                ),
                                                [
                                                    Ident(
                                                        "channel.1",
                                                    ),
                                                ],
                                            ),
                                        ),
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "channel",
                                            ty: None,
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "crossbeam_channel",
                                                            "unbounded",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        BinaryOp(
                                            Ident(
                                                "info_capteur_gaucheSend",
                                            ),
                                            "=",
                                            Call(
                                                Path(
                                                    [
                                                        "Some",
                                                    ],
                                                    Member,
                                                ),
                                                [
                                                    Ident(
                                                        "channel.0",
                                                    ),
                                                ],
                                            ),
                                        ),
                                    ),
                                    Expr(
                                        MethodCall(
                                            Ident(
                                                "th_ctrl_gauche.info_capteur",
                                            ),
                                            "receive",
                                            [
                                                Call(
                                                    Path(
                                                        [
                                                            "Some",
                                                        ],
                                                        Member,
                                                    ),
                                                    [
                                                        Ident(
                                                            "channel.1",
                                                        ),
                                                    ],
                                                ),
                                            ],
                                        ),
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "channel",
                                            ty: None,
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "crossbeam_channel",
                                                            "unbounded",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            Ident(
                                                "th_ctrl_gauche.comm_servo",
                                            ),
                                            "send",
                                            [
                                                Call(
                                                    Path(
                                                        [
                                                            "Some",
                                                        ],
                                                        Member,
                                                    ),
                                                    [
                                                        Ident(
                                                            "channel.0",
                                                        ),
                                                    ],
                                                ),
                                            ],
                                        ),
                                    ),
                                    Expr(
                                        BinaryOp(
                                            Ident(
                                                "comm_servo_gaucheRece",
                                            ),
                                            "=",
                                            Call(
                                                Path(
                                                    [
                                                        "Some",
                                                    ],
                                                    Member,
                                                ),
                                                [
                                                    Ident(
                                                        "channel.1",
                                                    ),
                                                ],
                                            ),
                                        ),
                                    ),
                                    Expr(
                                        Ident(
                                            "return Self { info_capteur_droit: None, info_capteur_droitSend, comm_servo_droit: None, comm_servo_droitRece, info_capteur_gauche: None, info_capteur_gaucheSend, comm_servo_gauche: None, comm_servo_gaucheRece, th_ctrl_droit, th_ctrl_gauche, cpu_id }  //显式return",
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: None,
                            docs: [
                                "// Creates a new process instance",
                            ],
                            attrs: [],
                        },
                    ),
                    Method(
                        FunctionDef {
                            name: "start",
                            params: [
                                Param {
                                    name: "self",
                                    ty: Named(
                                        "Self",
                                    ),
                                },
                            ],
                            return_type: Unit,
                            body: Block {
                                stmts: [
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "Self { info_capteur_droit, info_capteur_droitSend, comm_servo_droit, comm_servo_droitRece, info_capteur_gauche, info_capteur_gaucheSend, comm_servo_gauche, comm_servo_gaucheRece, th_ctrl_droit, th_ctrl_gauche, cpu_id, .. }",
                                            ty: None,
                                            init: Some(
                                                Ident(
                                                    "self",
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            BuilderChain(
                                                [
                                                    Named(
                                                        "\"th_ctrl_droit\".to_string()",
                                                    ),
                                                    Spawn {
                                                        closure: Closure(
                                                            [],
                                                            MethodCall(
                                                                Ident(
                                                                    "th_ctrl_droit",
                                                                ),
                                                                "run",
                                                                [],
                                                            ),
                                                        ),
                                                        move_kw: false,
                                                    },
                                                ],
                                            ),
                                            "unwrap",
                                            [],
                                        ),
                                    ),
                                    Expr(
                                        MethodCall(
                                            BuilderChain(
                                                [
                                                    Named(
                                                        "\"th_ctrl_gauche\".to_string()",
                                                    ),
                                                    Spawn {
                                                        closure: Closure(
                                                            [],
                                                            MethodCall(
                                                                Ident(
                                                                    "th_ctrl_gauche",
                                                                ),
                                                                "run",
                                                                [],
                                                            ),
                                                        ),
                                                        move_kw: false,
                                                    },
                                                ],
                                            ),
                                            "unwrap",
                                            [],
                                        ),
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: true,
                                            name: "comm_servo_droitRece_rx",
                                            ty: None,
                                            init: Some(
                                                MethodCall(
                                                    Ident(
                                                        "comm_servo_droitRece",
                                                    ),
                                                    "unwrap",
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            BuilderChain(
                                                [
                                                    Named(
                                                        "\"data_forwarder_comm_servo_droitRece\".to_string()",
                                                    ),
                                                    Spawn {
                                                        closure: Closure(
                                                            [],
                                                            Block(
                                                                Block {
                                                                    stmts: [
                                                                        Expr(
                                                                            Loop(
                                                                                Block {
                                                                                    stmts: [
                                                                                        Expr(
                                                                                            IfLet {
                                                                                                pattern: "Ok(msg)",
                                                                                                value: MethodCall(
                                                                                                    Ident(
                                                                                                        "comm_servo_droitRece_rx",
                                                                                                    ),
                                                                                                    "try_recv",
                                                                                                    [],
                                                                                                ),
                                                                                                then_branch: Block {
                                                                                                    stmts: [
                                                                                                        Expr(
                                                                                                            IfLet {
                                                                                                                pattern: "Some(tx)",
                                                                                                                value: Reference(
                                                                                                                    Ident(
                                                                                                                        "comm_servo_droit",
                                                                                                                    ),
                                                                                                                    true,
                                                                                                                    false,
                                                                                                                ),
                                                                                                                then_branch: Block {
                                                                                                                    stmts: [
                                                                                                                        Let(
                                                                                                                            LetStmt {
                                                                                                                                ifmut: false,
                                                                                                                                name: "_",
                                                                                                                                ty: None,
                                                                                                                                init: Some(
                                                                                                                                    MethodCall(
                                                                                                                                        Ident(
                                                                                                                                            "tx",
                                                                                                                                        ),
                                                                                                                                        "send",
                                                                                                                                        [
                                                                                                                                            Ident(
                                                                                                                                                "msg",
                                                                                                                                            ),
                                                                                                                                        ],
                                                                                                                                    ),
                                                                                                                                ),
                                                                                                                            },
                                                                                                                        ),
                                                                                                                    ],
                                                                                                                    expr: None,
                                                                                                                },
                                                                                                                else_branch: None,
                                                                                                            },
                                                                                                        ),
                                                                                                    ],
                                                                                                    expr: None,
                                                                                                },
                                                                                                else_branch: None,
                                                                                            },
                                                                                        ),
                                                                                        Expr(
                                                                                            MethodCall(
                                                                                                Path(
                                                                                                    [
                                                                                                        "std",
                                                                                                        "thread",
                                                                                                        "sleep",
                                                                                                    ],
                                                                                                    Namespace,
                                                                                                ),
                                                                                                "",
                                                                                                [
                                                                                                    MethodCall(
                                                                                                        Path(
                                                                                                            [
                                                                                                                "std",
                                                                                                                "time",
                                                                                                                "Duration",
                                                                                                                "from_millis",
                                                                                                            ],
                                                                                                            Namespace,
                                                                                                        ),
                                                                                                        "",
                                                                                                        [
                                                                                                            Literal(
                                                                                                                Int(
                                                                                                                    1,
                                                                                                                ),
                                                                                                            ),
                                                                                                        ],
                                                                                                    ),
                                                                                                ],
                                                                                            ),
                                                                                        ),
                                                                                    ],
                                                                                    expr: None,
                                                                                },
                                                                            ),
                                                                        ),
                                                                    ],
                                                                    expr: None,
                                                                },
                                                            ),
                                                        ),
                                                        move_kw: true,
                                                    },
                                                ],
                                            ),
                                            "unwrap",
                                            [],
                                        ),
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: true,
                                            name: "comm_servo_gaucheRece_rx",
                                            ty: None,
                                            init: Some(
                                                MethodCall(
                                                    Ident(
                                                        "comm_servo_gaucheRece",
                                                    ),
                                                    "unwrap",
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            BuilderChain(
                                                [
                                                    Named(
                                                        "\"data_forwarder_comm_servo_gaucheRece\".to_string()",
                                                    ),
                                                    Spawn {
                                                        closure: Closure(
                                                            [],
                                                            Block(
                                                                Block {
                                                                    stmts: [
                                                                        Expr(
                                                                            Loop(
                                                                                Block {
                                                                                    stmts: [
                                                                                        Expr(
                                                                                            IfLet {
                                                                                                pattern: "Ok(msg)",
                                                                                                value: MethodCall(
                                                                                                    Ident(
                                                                                                        "comm_servo_gaucheRece_rx",
                                                                                                    ),
                                                                                                    "try_recv",
                                                                                                    [],
                                                                                                ),
                                                                                                then_branch: Block {
                                                                                                    stmts: [
                                                                                                        Expr(
                                                                                                            IfLet {
                                                                                                                pattern: "Some(tx)",
                                                                                                                value: Reference(
                                                                                                                    Ident(
                                                                                                                        "comm_servo_gauche",
                                                                                                                    ),
                                                                                                                    true,
                                                                                                                    false,
                                                                                                                ),
                                                                                                                then_branch: Block {
                                                                                                                    stmts: [
                                                                                                                        Let(
                                                                                                                            LetStmt {
                                                                                                                                ifmut: false,
                                                                                                                                name: "_",
                                                                                                                                ty: None,
                                                                                                                                init: Some(
                                                                                                                                    MethodCall(
                                                                                                                                        Ident(
                                                                                                                                            "tx",
                                                                                                                                        ),
                                                                                                                                        "send",
                                                                                                                                        [
                                                                                                                                            Ident(
                                                                                                                                                "msg",
                                                                                                                                            ),
                                                                                                                                        ],
                                                                                                                                    ),
                                                                                                                                ),
                                                                                                                            },
                                                                                                                        ),
                                                                                                                    ],
                                                                                                                    expr: None,
                                                                                                                },
                                                                                                                else_branch: None,
                                                                                                            },
                                                                                                        ),
                                                                                                    ],
                                                                                                    expr: None,
                                                                                                },
                                                                                                else_branch: None,
                                                                                            },
                                                                                        ),
                                                                                        Expr(
                                                                                            MethodCall(
                                                                                                Path(
                                                                                                    [
                                                                                                        "std",
                                                                                                        "thread",
                                                                                                        "sleep",
                                                                                                    ],
                                                                                                    Namespace,
                                                                                                ),
                                                                                                "",
                                                                                                [
                                                                                                    MethodCall(
                                                                                                        Path(
                                                                                                            [
                                                                                                                "std",
                                                                                                                "time",
                                                                                                                "Duration",
                                                                                                                "from_millis",
                                                                                                            ],
                                                                                                            Namespace,
                                                                                                        ),
                                                                                                        "",
                                                                                                        [
                                                                                                            Literal(
                                                                                                                Int(
                                                                                                                    1,
                                                                                                                ),
                                                                                                            ),
                                                                                                        ],
                                                                                                    ),
                                                                                                ],
                                                                                            ),
                                                                                        ),
                                                                                    ],
                                                                                    expr: None,
                                                                                },
                                                                            ),
                                                                        ),
                                                                    ],
                                                                    expr: None,
                                                                },
                                                            ),
                                                        ),
                                                        move_kw: true,
                                                    },
                                                ],
                                            ),
                                            "unwrap",
                                            [],
                                        ),
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: true,
                                            name: "info_capteur_droit_rx",
                                            ty: None,
                                            init: Some(
                                                MethodCall(
                                                    Ident(
                                                        "info_capteur_droit",
                                                    ),
                                                    "unwrap",
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            BuilderChain(
                                                [
                                                    Named(
                                                        "\"data_forwarder_info_capteur_droit\".to_string()",
                                                    ),
                                                    Spawn {
                                                        closure: Closure(
                                                            [],
                                                            Block(
                                                                Block {
                                                                    stmts: [
                                                                        Expr(
                                                                            Loop(
                                                                                Block {
                                                                                    stmts: [
                                                                                        Expr(
                                                                                            IfLet {
                                                                                                pattern: "Ok(msg)",
                                                                                                value: MethodCall(
                                                                                                    Ident(
                                                                                                        "info_capteur_droit_rx",
                                                                                                    ),
                                                                                                    "try_recv",
                                                                                                    [],
                                                                                                ),
                                                                                                then_branch: Block {
                                                                                                    stmts: [
                                                                                                        Expr(
                                                                                                            IfLet {
                                                                                                                pattern: "Some(tx)",
                                                                                                                value: Reference(
                                                                                                                    Ident(
                                                                                                                        "info_capteur_droitSend",
                                                                                                                    ),
                                                                                                                    true,
                                                                                                                    false,
                                                                                                                ),
                                                                                                                then_branch: Block {
                                                                                                                    stmts: [
                                                                                                                        Let(
                                                                                                                            LetStmt {
                                                                                                                                ifmut: false,
                                                                                                                                name: "_",
                                                                                                                                ty: None,
                                                                                                                                init: Some(
                                                                                                                                    MethodCall(
                                                                                                                                        Ident(
                                                                                                                                            "tx",
                                                                                                                                        ),
                                                                                                                                        "send",
                                                                                                                                        [
                                                                                                                                            Ident(
                                                                                                                                                "msg",
                                                                                                                                            ),
                                                                                                                                        ],
                                                                                                                                    ),
                                                                                                                                ),
                                                                                                                            },
                                                                                                                        ),
                                                                                                                    ],
                                                                                                                    expr: None,
                                                                                                                },
                                                                                                                else_branch: None,
                                                                                                            },
                                                                                                        ),
                                                                                                    ],
                                                                                                    expr: None,
                                                                                                },
                                                                                                else_branch: None,
                                                                                            },
                                                                                        ),
                                                                                        Expr(
                                                                                            MethodCall(
                                                                                                Path(
                                                                                                    [
                                                                                                        "std",
                                                                                                        "thread",
                                                                                                        "sleep",
                                                                                                    ],
                                                                                                    Namespace,
                                                                                                ),
                                                                                                "",
                                                                                                [
                                                                                                    MethodCall(
                                                                                                        Path(
                                                                                                            [
                                                                                                                "std",
                                                                                                                "time",
                                                                                                                "Duration",
                                                                                                                "from_millis",
                                                                                                            ],
                                                                                                            Namespace,
                                                                                                        ),
                                                                                                        "",
                                                                                                        [
                                                                                                            Literal(
                                                                                                                Int(
                                                                                                                    1,
                                                                                                                ),
                                                                                                            ),
                                                                                                        ],
                                                                                                    ),
                                                                                                ],
                                                                                            ),
                                                                                        ),
                                                                                    ],
                                                                                    expr: None,
                                                                                },
                                                                            ),
                                                                        ),
                                                                    ],
                                                                    expr: None,
                                                                },
                                                            ),
                                                        ),
                                                        move_kw: true,
                                                    },
                                                ],
                                            ),
                                            "unwrap",
                                            [],
                                        ),
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: true,
                                            name: "info_capteur_gauche_rx",
                                            ty: None,
                                            init: Some(
                                                MethodCall(
                                                    Ident(
                                                        "info_capteur_gauche",
                                                    ),
                                                    "unwrap",
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            BuilderChain(
                                                [
                                                    Named(
                                                        "\"data_forwarder_info_capteur_gauche\".to_string()",
                                                    ),
                                                    Spawn {
                                                        closure: Closure(
                                                            [],
                                                            Block(
                                                                Block {
                                                                    stmts: [
                                                                        Expr(
                                                                            Loop(
                                                                                Block {
                                                                                    stmts: [
                                                                                        Expr(
                                                                                            IfLet {
                                                                                                pattern: "Ok(msg)",
                                                                                                value: MethodCall(
                                                                                                    Ident(
                                                                                                        "info_capteur_gauche_rx",
                                                                                                    ),
                                                                                                    "try_recv",
                                                                                                    [],
                                                                                                ),
                                                                                                then_branch: Block {
                                                                                                    stmts: [
                                                                                                        Expr(
                                                                                                            IfLet {
                                                                                                                pattern: "Some(tx)",
                                                                                                                value: Reference(
                                                                                                                    Ident(
                                                                                                                        "info_capteur_gaucheSend",
                                                                                                                    ),
                                                                                                                    true,
                                                                                                                    false,
                                                                                                                ),
                                                                                                                then_branch: Block {
                                                                                                                    stmts: [
                                                                                                                        Let(
                                                                                                                            LetStmt {
                                                                                                                                ifmut: false,
                                                                                                                                name: "_",
                                                                                                                                ty: None,
                                                                                                                                init: Some(
                                                                                                                                    MethodCall(
                                                                                                                                        Ident(
                                                                                                                                            "tx",
                                                                                                                                        ),
                                                                                                                                        "send",
                                                                                                                                        [
                                                                                                                                            Ident(
                                                                                                                                                "msg",
                                                                                                                                            ),
                                                                                                                                        ],
                                                                                                                                    ),
                                                                                                                                ),
                                                                                                                            },
                                                                                                                        ),
                                                                                                                    ],
                                                                                                                    expr: None,
                                                                                                                },
                                                                                                                else_branch: None,
                                                                                                            },
                                                                                                        ),
                                                                                                    ],
                                                                                                    expr: None,
                                                                                                },
                                                                                                else_branch: None,
                                                                                            },
                                                                                        ),
                                                                                        Expr(
                                                                                            MethodCall(
                                                                                                Path(
                                                                                                    [
                                                                                                        "std",
                                                                                                        "thread",
                                                                                                        "sleep",
                                                                                                    ],
                                                                                                    Namespace,
                                                                                                ),
                                                                                                "",
                                                                                                [
                                                                                                    MethodCall(
                                                                                                        Path(
                                                                                                            [
                                                                                                                "std",
                                                                                                                "time",
                                                                                                                "Duration",
                                                                                                                "from_millis",
                                                                                                            ],
                                                                                                            Namespace,
                                                                                                        ),
                                                                                                        "",
                                                                                                        [
                                                                                                            Literal(
                                                                                                                Int(
                                                                                                                    1,
                                                                                                                ),
                                                                                                            ),
                                                                                                        ],
                                                                                                    ),
                                                                                                ],
                                                                                            ),
                                                                                        ),
                                                                                    ],
                                                                                    expr: None,
                                                                                },
                                                                            ),
                                                                        ),
                                                                    ],
                                                                    expr: None,
                                                                },
                                                            ),
                                                        ),
                                                        move_kw: true,
                                                    },
                                                ],
                                            ),
                                            "unwrap",
                                            [],
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: None,
                            docs: [
                                "// Starts all threads in the process",
                            ],
                            attrs: [],
                        },
                    ),
                ],
                trait_impl: Some(
                    Named(
                        "Process",
                    ),
                ),
            },
        ),
        Impl(
            ImplBlock {
                target: Named(
                    "p_servomoteurProcess",
                ),
                generics: [],
                items: [
                    Method(
                        FunctionDef {
                            name: "new",
                            params: [
                                Param {
                                    name: "cpu_id",
                                    ty: Named(
                                        "isize",
                                    ),
                                },
                            ],
                            return_type: Named(
                                "Self",
                            ),
                            body: Block {
                                stmts: [
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "mut th_servomoteur",
                                            ty: Some(
                                                Named(
                                                    "servomoteurThread",
                                                ),
                                            ),
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "servomoteurThread",
                                                            "new",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [
                                                        Ident(
                                                            "cpu_id",
                                                        ),
                                                    ],
                                                ),
                                            ),
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: true,
                                            name: "ordreSend",
                                            ty: None,
                                            init: Some(
                                                Ident(
                                                    "None",
                                                ),
                                            ),
                                        },
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "channel",
                                            ty: None,
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "crossbeam_channel",
                                                            "unbounded",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        BinaryOp(
                                            Ident(
                                                "ordreSend",
                                            ),
                                            "=",
                                            Call(
                                                Path(
                                                    [
                                                        "Some",
                                                    ],
                                                    Member,
                                                ),
                                                [
                                                    Ident(
                                                        "channel.0",
                                                    ),
                                                ],
                                            ),
                                        ),
                                    ),
                                    Expr(
                                        MethodCall(
                                            Ident(
                                                "th_servomoteur.ordre",
                                            ),
                                            "receive",
                                            [
                                                Call(
                                                    Path(
                                                        [
                                                            "Some",
                                                        ],
                                                        Member,
                                                    ),
                                                    [
                                                        Ident(
                                                            "channel.1",
                                                        ),
                                                    ],
                                                ),
                                            ],
                                        ),
                                    ),
                                    Expr(
                                        Ident(
                                            "return Self { ordre: None, ordreSend, th_servomoteur, cpu_id }  //显式return",
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: None,
                            docs: [
                                "// Creates a new process instance",
                            ],
                            attrs: [],
                        },
                    ),
                    Method(
                        FunctionDef {
                            name: "start",
                            params: [
                                Param {
                                    name: "self",
                                    ty: Named(
                                        "Self",
                                    ),
                                },
                            ],
                            return_type: Unit,
                            body: Block {
                                stmts: [
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "Self { ordre, ordreSend, th_servomoteur, cpu_id, .. }",
                                            ty: None,
                                            init: Some(
                                                Ident(
                                                    "self",
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            BuilderChain(
                                                [
                                                    Named(
                                                        "\"th_servomoteur\".to_string()",
                                                    ),
                                                    Spawn {
                                                        closure: Closure(
                                                            [],
                                                            MethodCall(
                                                                Ident(
                                                                    "th_servomoteur",
                                                                ),
                                                                "run",
                                                                [],
                                                            ),
                                                        ),
                                                        move_kw: false,
                                                    },
                                                ],
                                            ),
                                            "unwrap",
                                            [],
                                        ),
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: true,
                                            name: "ordre_rx",
                                            ty: None,
                                            init: Some(
                                                MethodCall(
                                                    Ident(
                                                        "ordre",
                                                    ),
                                                    "unwrap",
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            BuilderChain(
                                                [
                                                    Named(
                                                        "\"data_forwarder_ordre\".to_string()",
                                                    ),
                                                    Spawn {
                                                        closure: Closure(
                                                            [],
                                                            Block(
                                                                Block {
                                                                    stmts: [
                                                                        Expr(
                                                                            Loop(
                                                                                Block {
                                                                                    stmts: [
                                                                                        Expr(
                                                                                            IfLet {
                                                                                                pattern: "Ok(msg)",
                                                                                                value: MethodCall(
                                                                                                    Ident(
                                                                                                        "ordre_rx",
                                                                                                    ),
                                                                                                    "try_recv",
                                                                                                    [],
                                                                                                ),
                                                                                                then_branch: Block {
                                                                                                    stmts: [
                                                                                                        Expr(
                                                                                                            IfLet {
                                                                                                                pattern: "Some(tx)",
                                                                                                                value: Reference(
                                                                                                                    Ident(
                                                                                                                        "ordreSend",
                                                                                                                    ),
                                                                                                                    true,
                                                                                                                    false,
                                                                                                                ),
                                                                                                                then_branch: Block {
                                                                                                                    stmts: [
                                                                                                                        Let(
                                                                                                                            LetStmt {
                                                                                                                                ifmut: false,
                                                                                                                                name: "_",
                                                                                                                                ty: None,
                                                                                                                                init: Some(
                                                                                                                                    MethodCall(
                                                                                                                                        Ident(
                                                                                                                                            "tx",
                                                                                                                                        ),
                                                                                                                                        "send",
                                                                                                                                        [
                                                                                                                                            Ident(
                                                                                                                                                "msg",
                                                                                                                                            ),
                                                                                                                                        ],
                                                                                                                                    ),
                                                                                                                                ),
                                                                                                                            },
                                                                                                                        ),
                                                                                                                    ],
                                                                                                                    expr: None,
                                                                                                                },
                                                                                                                else_branch: None,
                                                                                                            },
                                                                                                        ),
                                                                                                    ],
                                                                                                    expr: None,
                                                                                                },
                                                                                                else_branch: None,
                                                                                            },
                                                                                        ),
                                                                                        Expr(
                                                                                            MethodCall(
                                                                                                Path(
                                                                                                    [
                                                                                                        "std",
                                                                                                        "thread",
                                                                                                        "sleep",
                                                                                                    ],
                                                                                                    Namespace,
                                                                                                ),
                                                                                                "",
                                                                                                [
                                                                                                    MethodCall(
                                                                                                        Path(
                                                                                                            [
                                                                                                                "std",
                                                                                                                "time",
                                                                                                                "Duration",
                                                                                                                "from_millis",
                                                                                                            ],
                                                                                                            Namespace,
                                                                                                        ),
                                                                                                        "",
                                                                                                        [
                                                                                                            Literal(
                                                                                                                Int(
                                                                                                                    1,
                                                                                                                ),
                                                                                                            ),
                                                                                                        ],
                                                                                                    ),
                                                                                                ],
                                                                                            ),
                                                                                        ),
                                                                                    ],
                                                                                    expr: None,
                                                                                },
                                                                            ),
                                                                        ),
                                                                    ],
                                                                    expr: None,
                                                                },
                                                            ),
                                                        ),
                                                        move_kw: true,
                                                    },
                                                ],
                                            ),
                                            "unwrap",
                                            [],
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: None,
                            docs: [
                                "// Starts all threads in the process",
                            ],
                            attrs: [],
                        },
                    ),
                ],
                trait_impl: Some(
                    Named(
                        "Process",
                    ),
                ),
            },
        ),
        Struct(
            StructDef {
                name: "robotSystem",
                fields: [
                    Field {
                        name: "proc_capteur_droit",
                        ty: Named(
                            "p_capteurProcess",
                        ),
                        docs: [
                            "// 子组件进程（proc_capteur_droit : process p_capteur）",
                        ],
                        attrs: [
                            Attribute {
                                name: "allow",
                                args: [
                                    Ident(
                                        "dead_code",
                                    ),
                                ],
                            },
                        ],
                    },
                    Field {
                        name: "proc_capteur_gauche",
                        ty: Named(
                            "p_capteurProcess",
                        ),
                        docs: [
                            "// 子组件进程（proc_capteur_gauche : process p_capteur）",
                        ],
                        attrs: [
                            Attribute {
                                name: "allow",
                                args: [
                                    Ident(
                                        "dead_code",
                                    ),
                                ],
                            },
                        ],
                    },
                    Field {
                        name: "proc_controle",
                        ty: Named(
                            "p_controleProcess",
                        ),
                        docs: [
                            "// 子组件进程（proc_controle : process p_controle）",
                        ],
                        attrs: [
                            Attribute {
                                name: "allow",
                                args: [
                                    Ident(
                                        "dead_code",
                                    ),
                                ],
                            },
                        ],
                    },
                    Field {
                        name: "proc_servomoteur_droit",
                        ty: Named(
                            "p_servomoteurProcess",
                        ),
                        docs: [
                            "// 子组件进程（proc_servomoteur_droit : process p_servomoteur）",
                        ],
                        attrs: [
                            Attribute {
                                name: "allow",
                                args: [
                                    Ident(
                                        "dead_code",
                                    ),
                                ],
                            },
                        ],
                    },
                    Field {
                        name: "proc_servomoteur_gauche",
                        ty: Named(
                            "p_servomoteurProcess",
                        ),
                        docs: [
                            "// 子组件进程（proc_servomoteur_gauche : process p_servomoteur）",
                        ],
                        attrs: [
                            Attribute {
                                name: "allow",
                                args: [
                                    Ident(
                                        "dead_code",
                                    ),
                                ],
                            },
                        ],
                    },
                ],
                properties: [],
                generics: [],
                derives: [
                    "Debug",
                ],
                docs: [
                    "// AADL System: robot",
                ],
                vis: Public,
            },
        ),
        Impl(
            ImplBlock {
                target: Named(
                    "robotSystem",
                ),
                generics: [],
                items: [
                    Method(
                        FunctionDef {
                            name: "new",
                            params: [],
                            return_type: Named(
                                "Self",
                            ),
                            body: Block {
                                stmts: [
                                    Expr(
                                        Ident(
                                            "let mut proc_capteur_droit: p_capteurProcess = p_capteurProcess::new(0)",
                                        ),
                                    ),
                                    Expr(
                                        Ident(
                                            "let mut proc_capteur_gauche: p_capteurProcess = p_capteurProcess::new(0)",
                                        ),
                                    ),
                                    Expr(
                                        Ident(
                                            "let mut proc_controle: p_controleProcess = p_controleProcess::new(0)",
                                        ),
                                    ),
                                    Expr(
                                        Ident(
                                            "let mut proc_servomoteur_droit: p_servomoteurProcess = p_servomoteurProcess::new(0)",
                                        ),
                                    ),
                                    Expr(
                                        Ident(
                                            "let mut proc_servomoteur_gauche: p_servomoteurProcess = p_servomoteurProcess::new(0)",
                                        ),
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "channel",
                                            ty: None,
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "crossbeam_channel",
                                                            "unbounded",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            Ident(
                                                "proc_capteur_droit.evenement",
                                            ),
                                            "send",
                                            [
                                                Call(
                                                    Path(
                                                        [
                                                            "Some",
                                                        ],
                                                        Member,
                                                    ),
                                                    [
                                                        Ident(
                                                            "channel.0",
                                                        ),
                                                    ],
                                                ),
                                            ],
                                        ),
                                    ),
                                    Expr(
                                        MethodCall(
                                            Ident(
                                                "proc_controle.info_capteur_droit",
                                            ),
                                            "receive",
                                            [
                                                Call(
                                                    Path(
                                                        [
                                                            "Some",
                                                        ],
                                                        Member,
                                                    ),
                                                    [
                                                        Ident(
                                                            "channel.1",
                                                        ),
                                                    ],
                                                ),
                                            ],
                                        ),
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "channel",
                                            ty: None,
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "crossbeam_channel",
                                                            "unbounded",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            Ident(
                                                "proc_capteur_gauche.evenement",
                                            ),
                                            "send",
                                            [
                                                Call(
                                                    Path(
                                                        [
                                                            "Some",
                                                        ],
                                                        Member,
                                                    ),
                                                    [
                                                        Ident(
                                                            "channel.0",
                                                        ),
                                                    ],
                                                ),
                                            ],
                                        ),
                                    ),
                                    Expr(
                                        MethodCall(
                                            Ident(
                                                "proc_controle.info_capteur_gauche",
                                            ),
                                            "receive",
                                            [
                                                Call(
                                                    Path(
                                                        [
                                                            "Some",
                                                        ],
                                                        Member,
                                                    ),
                                                    [
                                                        Ident(
                                                            "channel.1",
                                                        ),
                                                    ],
                                                ),
                                            ],
                                        ),
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "channel",
                                            ty: None,
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "crossbeam_channel",
                                                            "unbounded",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            Ident(
                                                "proc_controle.comm_servo_droit",
                                            ),
                                            "send",
                                            [
                                                Call(
                                                    Path(
                                                        [
                                                            "Some",
                                                        ],
                                                        Member,
                                                    ),
                                                    [
                                                        Ident(
                                                            "channel.0",
                                                        ),
                                                    ],
                                                ),
                                            ],
                                        ),
                                    ),
                                    Expr(
                                        MethodCall(
                                            Ident(
                                                "proc_servomoteur_droit.ordre",
                                            ),
                                            "receive",
                                            [
                                                Call(
                                                    Path(
                                                        [
                                                            "Some",
                                                        ],
                                                        Member,
                                                    ),
                                                    [
                                                        Ident(
                                                            "channel.1",
                                                        ),
                                                    ],
                                                ),
                                            ],
                                        ),
                                    ),
                                    Let(
                                        LetStmt {
                                            ifmut: false,
                                            name: "channel",
                                            ty: None,
                                            init: Some(
                                                Call(
                                                    Path(
                                                        [
                                                            "crossbeam_channel",
                                                            "unbounded",
                                                        ],
                                                        Namespace,
                                                    ),
                                                    [],
                                                ),
                                            ),
                                        },
                                    ),
                                    Expr(
                                        MethodCall(
                                            Ident(
                                                "proc_controle.comm_servo_gauche",
                                            ),
                                            "send",
                                            [
                                                Call(
                                                    Path(
                                                        [
                                                            "Some",
                                                        ],
                                                        Member,
                                                    ),
                                                    [
                                                        Ident(
                                                            "channel.0",
                                                        ),
                                                    ],
                                                ),
                                            ],
                                        ),
                                    ),
                                    Expr(
                                        MethodCall(
                                            Ident(
                                                "proc_servomoteur_gauche.ordre",
                                            ),
                                            "receive",
                                            [
                                                Call(
                                                    Path(
                                                        [
                                                            "Some",
                                                        ],
                                                        Member,
                                                    ),
                                                    [
                                                        Ident(
                                                            "channel.1",
                                                        ),
                                                    ],
                                                ),
                                            ],
                                        ),
                                    ),
                                    Expr(
                                        Ident(
                                            "return Self { proc_capteur_droit, proc_capteur_gauche, proc_controle, proc_servomoteur_droit, proc_servomoteur_gauche }  //显式return",
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: None,
                            docs: [
                                "// Creates a new system instance",
                            ],
                            attrs: [],
                        },
                    ),
                    Method(
                        FunctionDef {
                            name: "run",
                            params: [
                                Param {
                                    name: "self",
                                    ty: Named(
                                        "Self",
                                    ),
                                },
                            ],
                            return_type: Unit,
                            body: Block {
                                stmts: [
                                    Expr(
                                        Ident(
                                            "self.proc_capteur_droit.start()",
                                        ),
                                    ),
                                    Expr(
                                        Ident(
                                            "self.proc_capteur_gauche.start()",
                                        ),
                                    ),
                                    Expr(
                                        Ident(
                                            "self.proc_controle.start()",
                                        ),
                                    ),
                                    Expr(
                                        Ident(
                                            "self.proc_servomoteur_droit.start()",
                                        ),
                                    ),
                                    Expr(
                                        Ident(
                                            "self.proc_servomoteur_gauche.start()",
                                        ),
                                    ),
                                ],
                                expr: None,
                            },
                            asyncness: false,
                            vis: None,
                            docs: [
                                "// Runs the system, starts all processes",
                            ],
                            attrs: [],
                        },
                    ),
                ],
                trait_impl: Some(
                    Named(
                        "System",
                    ),
                ),
            },
        ),
        LazyStatic(
            LazyStaticDef {
                name: "CPU_ID_TO_SCHED_POLICY",
                ty: Generic(
                    "HashMap",
                    [
                        Named(
                            "isize",
                        ),
                        Named(
                            "i32",
                        ),
                    ],
                ),
                init: Block {
                    stmts: [
                        Let(
                            LetStmt {
                                ifmut: true,
                                name: "map",
                                ty: Some(
                                    Generic(
                                        "HashMap",
                                        [
                                            Named(
                                                "isize",
                                            ),
                                            Named(
                                                "i32",
                                            ),
                                        ],
                                    ),
                                ),
                                init: Some(
                                    Call(
                                        Path(
                                            [
                                                "HashMap",
                                                "new",
                                            ],
                                            Namespace,
                                        ),
                                        [],
                                    ),
                                ),
                            },
                        ),
                        Expr(
                            MethodCall(
                                Ident(
                                    "map",
                                ),
                                "insert",
                                [
                                    Literal(
                                        Int(
                                            0,
                                        ),
                                    ),
                                    Path(
                                        [
                                            "SCHED_FIFO",
                                        ],
                                        Namespace,
                                    ),
                                ],
                            ),
                        ),
                        Expr(
                            Ident(
                                "return map",
                            ),
                        ),
                    ],
                    expr: None,
                },
                vis: Public,
                docs: [
                    "// CPU ID到调度策略的映射",
                ],
            },
        ),
        Function(
            FunctionDef {
                name: "period_to_priority",
                params: [
                    Param {
                        name: "period_ms",
                        ty: Named(
                            "f64",
                        ),
                    },
                ],
                return_type: Named(
                    "i32",
                ),
                body: Block {
                    stmts: [
                        Let(
                            LetStmt {
                                ifmut: false,
                                name: "k",
                                ty: Some(
                                    Named(
                                        "f64",
                                    ),
                                ),
                                init: Some(
                                    Ident(
                                        "10.0",
                                    ),
                                ),
                            },
                        ),
                        Let(
                            LetStmt {
                                ifmut: false,
                                name: "raw",
                                ty: Some(
                                    Named(
                                        "f64",
                                    ),
                                ),
                                init: Some(
                                    BinaryOp(
                                        Ident(
                                            "99.0",
                                        ),
                                        "-",
                                        MethodCall(
                                            BinaryOp(
                                                Ident(
                                                    "k",
                                                ),
                                                "*",
                                                MethodCall(
                                                    Ident(
                                                        "period_ms",
                                                    ),
                                                    "log10",
                                                    [],
                                                ),
                                            ),
                                            "floor",
                                            [],
                                        ),
                                    ),
                                ),
                            },
                        ),
                        Expr(
                            Ident(
                                "return raw.max(1.0).min(99.0) as i32",
                            ),
                        ),
                    ],
                    expr: None,
                },
                asyncness: false,
                vis: Public,
                docs: [
                    "// prio(P)=max(1,min(99,99−⌊k⋅log10(P)⌋))",
                    "// 根据周期计算优先级，周期越短优先级越高",
                    "// 用于 RMS (Rate Monotonic Scheduling) 和 DMS (Deadline Monotonic Scheduling)",
                ],
                attrs: [],
            },
        ),
    ],
    attrs: [],
    vis: Public,
}