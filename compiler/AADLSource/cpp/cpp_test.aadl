-- 系统功能概述：
-- 这是一个最简单的C/C++测试案例，主要用于验证AADL工具链对C语言程序的支持。
-- 系统只包含一个线程，该线程周期性地调用一个打印"hello world"的子程序。
--
-- 线程功能：
-- Task线程（周期为1000ms，优先级为1）：周期性调用Hello_Spg_1子程序，
-- 该子程序执行hello.c文件中的hello_world函数，打印"hello world"信息。
--
-- 系统特点：
-- 1. 这是最简单的AADL案例，结构清晰，便于理解AADL基本概念
-- 2. 展示了AADL对C语言程序的支持和集成方式
-- 3. 使用POSIX最高优先级优先调度协议
-- 4. 单线程、单进程、单处理器架构
package CPP_Test
public

  -----------------
  -- Subprograms --
  -----------------

  subprogram Hello_Spg_1
  properties
    source_language => (C);
    source_name     => "hello_world";
    source_text     => ("hello.c");
  end Hello_Spg_1;

  -------------
  -- Threads --
  -------------

  thread Task
  end Task;

  thread implementation Task.impl_1
  calls
    Mycalls: {
    P_Spg : subprogram Hello_Spg_1;
    };
  properties
    Dispatch_Protocol                  => Periodic;
    Period                             => 1000ms;
    Priority                           => 1;
  end Task.impl_1;

  ---------------
  -- Processor --
  ---------------

  processor cpurm
  end cpurm;

  processor implementation cpurm.impl
  properties
    Scheduling_Protocol => (Posix_1003_Highest_Priority_First_Protocol);
  end cpurm.impl;

  ---------------
  -- Processes --
  ---------------

  process node_a
  end node_a;

  process implementation node_a.impl
  subcomponents
    Task1 : thread Task.impl_1;
  end node_a.impl;

  ------------
  -- System --
  ------------

  system cpp_test
  end cpp_test;

  system implementation cpp_test.impl
  subcomponents
    cpptest : process node_a.impl;
    cpu_rm : processor cpurm.impl;
  properties
    Actual_Processor_Binding => reference (cpu_rm) applies to cpptest;
  end cpp_test.impl;

  -- system implementation cpp_test.Xenomai
  -- extends cpp_test.impl
  -- properties
  --   Deployment::Execution_Platform => linux32_xenomai_native applies to cpu_rm;
  -- end cpp_test.Xenomai;

  -- system implementation cpp_test.RTEMS
  -- extends cpp_test.impl
  -- properties
  --   Deployment::Execution_platform => LEON_RTEMS applies to cpu_rm;
  -- end cpp_test.RTEMS;

end cpp_test;
